<% include _header %>

<main class='main-first-page' ng-controller='DashboardCtrl'>
  <div class='container'>

    <% include _navTabs %>

    <div class='dashboard-container border-blue box-shadow'>
      <div class='row'>
        <div class='col-xs-12 col-sm-12 col-md-12'>
          <%# include _buttons %>
        </div>
        <div class='col-xs-12 col-sm-12 col-md-12'>
          <div class='row'>
            <div class='dashboard-container'>
              <h2 class="center-block">
                Account Database
                <a class="btn border-yellow pull-right" href="/dashboard/exportCsv">
                  Exprot to CSV 
                </a> 
              </h2>
              <h4><%= message %></h4>
              <div id="signup" class="tab-pane fade in active">

              <table class="table table-hover"> 
                <thead> 
                  <tr> 
                    <th>Account Name</th> 
                    <th>Users</th> 
                  </tr> 
                </thead> 
                <tbody> 
                  <% accounts.forEach(function(account) { %>
                    <tr> 
                      <td><%= account.name %></td>
                      <td>
                        <% account.Users.forEach(function(user) { %>
                          <p>
                            Full Name: <%= user.firstName %> <%= user.lastName %>
                            <br>
                            <form method="post" action="/dashboard/reactivateOrDeactivate">
                              <input type="hidden" name="userId" value="<%= user.id %>">
                              <input type="hidden" name="accountId" value="<%= account.id %>">
                              <% account.AccountUsers.forEach(function(result) { %>
                                <% if ( result.accountId === account.id || result.userId === user.id || result.active === true ) { %>
                                  <button type='submit' class='btn-simple border-red text-red-dark' id='userCommentButton'>Deactivate</button>
                                <% }else{ %>
                                  <button type='submit' class='btn-simple border-green text-green-dark' id='userCommentButton'>Reactivate</button>
                                <% }; %>
                              <% }); %>
                            </form>
                          </p>
                          <p>Date of Sign-up: <%= user.createdAt %></p>
                          <p>E-mail: <%= user.email %></p>
                          <p>Postal Address: <%= user.postaAddress %></p>
                          <p>Ciry: <%= user.city %></p>
                          <p>Postcode: <%= user.postcode %></p>
                          <p>Country: <%= user.country %></p>
                          <p>Company: <%= user.companyName %></p>
                          <p>Mobile: <%= user.mobileNumber %></p>
                          <p># Sessions purchased: TODO need fuctionality for this</p>
                          <p>Tipe permission: TODO need fuctionality for this</p>
                          <p># Active Sessions: TODO need fuctionality for this</p>
                          <p>
                            Comments: <%= user.comment %>
                            <a href='#' data-toggle='modal' data-target="#accountDatabaseCommentModal_<%= user.id %>">Edit Comment</a>
                          </p>

                          <div class='modal fade' id="accountDatabaseCommentModal_<%= user.id %>" role='dialog'>
                          <div class="modal-dialog accountDatabaseCommentModal_<%= user.id %>">
                              <div class='modal-content border-green border-radius-none'>
                                <div class='modal-header'>
                                  <button type='button' class='close' data-dismiss='modal'>&times;</button>
                                  <h2 class='modal-title text-center'>Edit Comment</h2>
                                  <h4><%#= error %></h4>
                                </div>
                                <div class='modal-body'>
                                  <div class='tab-pane fade in active'>
                                    <div class='text-center background-green'><b id='userCommentMessage'></b></div>
                                    <div id='userCommentError' class='text-center background-red'></div>

                                    <form method="post" action="/dashboard/updateComment" id="userCommentForm_<%= user.id %>">
                                      <input type="hidden" name="userId" value="<%= user.id %>">
                                      <div class="form-group">
                                        <label for="comment">Comment</label>
                                        <textarea class="form-control center-block" name="comment" form="userCommentForm_<%= user.id %>" placeholder></textarea>
                                      </div>
                                      <div class='modal-footer'>
                                        <button type='button' class='btn-simple border-green text-green-dark' data-dismiss='modal'>Close</button>
                                        <button type='submit' class='btn-simple border-green text-green-dark' id='userCommentButton'>Save</button>
                                      </div>
                                    </form>

                                  </div>
                                </div>
                              </div>
                            </div>
                          </div>
                          <hr>
                        <%  }); %>
                      </td>
                    </tr> 
                  <%  }); %>
                </tbody> 
              </table>

              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</main>

<% include ../footer %>
